<!DOCTYPE html>
<html>
<head>
    <title>Checkout Debug Test</title>
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { margin: 20px 0; padding: 15px; border: 1px solid #ccc; background: #f9f9f9; }
        .error { border-color: red; background: #ffe6e6; }
        .success { border-color: green; background: #e6ffe6; }
        button { padding: 10px 20px; margin: 10px; background: #007cba; color: white; border: none; cursor: pointer; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Checkout Debug Test</h1>
    
    <h3>Test Data Being Sent:</h3>
    <pre id="testData"></pre>
    
    <button onclick="testCheckout()">Test Checkout</button>
    <button onclick="clearResults()">Clear Results</button>
    
    <div id="results"></div>

    <script>
        // Set up CSRF token for all AJAX requests
        $.ajaxSetup({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            }
        });

        const testData = {
            packageName: 'Premium Package',
            packageDescription: 'This is a test premium package with extended features',
            packagePrice: 200,
            deliveryTime: '3 days',
            gigId: 70,
            billingDetails: {
                name: 'Test User',
                email: 'test@example.com',
                address: '123 Test Street',
                city: 'Test City',
                state: 'Test State',
                zip: '12345',
                phone: '+1234567890'
            }
        };

        // Display the test data
        document.getElementById('testData').textContent = JSON.stringify(testData, null, 2);

        function testCheckout() {
            const resultDiv = document.getElementById('results');
            resultDiv.innerHTML = '<div class="result">Testing checkout...</div>';
            
            console.log('Sending data:', testData);

            $.ajax({
                url: '/checkout',
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(testData),
                success: function(response) {
                    resultDiv.innerHTML = '<div class="result success"><h3>✅ Success!</h3><pre>' + JSON.stringify(response, null, 2) + '</pre></div>';
                },
                error: function(xhr) {
                    console.error('Error details:', xhr);
                    let errorDetails = {
                        status: xhr.status,
                        statusText: xhr.statusText,
                        response: xhr.responseText
                    };
                    
                    try {
                        errorDetails.responseJSON = JSON.parse(xhr.responseText);
                    } catch(e) {
                        errorDetails.parseError = 'Could not parse response as JSON';
                    }
                    
                    resultDiv.innerHTML = '<div class="result error"><h3>❌ Error!</h3><pre>' + JSON.stringify(errorDetails, null, 2) + '</pre></div>';
                }
            });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
