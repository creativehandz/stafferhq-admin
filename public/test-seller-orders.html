<!DOCTYPE html>
<html>
<head>
    <title>Test Seller Orders API</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>Test Seller Orders API</h1>
    
    <h2>1. Login Status</h2>
    <div id="login-status">Checking...</div>
    
    <h2>2. Login Form</h2>
    <form id="login-form">
        <input type="email" value="pranavtfcppp@gmail.com" placeholder="Email"><br><br>
        <input type="password" value="12345678" placeholder="Password"><br><br>
        <button type="submit">Login</button>
    </form>
    
    <h2>3. Test Seller Orders</h2>
    <button id="test-seller-orders">Get Seller Orders</button>
    <div id="seller-orders-result" style="white-space: pre-wrap; margin-top: 10px;"></div>

    <script>
        // Check login status
        function checkLoginStatus() {
            $.get('/api/user')
                .done(function(data) {
                    $('#login-status').html('✓ Logged in as: ' + data.name + ' (ID: ' + data.id + ')');
                })
                .fail(function() {
                    $('#login-status').html('✗ Not logged in');
                });
        }

        // Login
        $('#login-form').submit(function(e) {
            e.preventDefault();
            
            $.get('/sanctum/csrf-cookie')
                .then(function() {
                    return $.post('/login', {
                        email: $('input[type="email"]').val(),
                        password: $('input[type="password"]').val(),
                    });
                })
                .done(function() {
                    $('#login-status').html('✓ Login successful!');
                    checkLoginStatus();
                })
                .fail(function(xhr) {
                    $('#login-status').html('✗ Login failed: ' + xhr.responseText);
                });
        });

        // Test seller orders
        $('#test-seller-orders').click(function() {
            $('#seller-orders-result').text('Loading...');
            
            $.get('/seller-orders')
                .done(function(data) {
                    let result = 'Total orders: ' + data.length + '\n\n';
                    
                    // Group by status
                    let statusGroups = {};
                    data.forEach(order => {
                        if (!statusGroups[order.status]) {
                            statusGroups[order.status] = [];
                        }
                        statusGroups[order.status].push(order);
                    });
                    
                    result += 'Orders by status:\n';
                    Object.keys(statusGroups).forEach(status => {
                        result += '- ' + status + ': ' + statusGroups[status].length + ' orders\n';
                        statusGroups[status].forEach(order => {
                            let orderDetails = '';
                            try {
                                let details = JSON.parse(order.order_details);
                                orderDetails = details.gig || order.package_selected || 'Unknown';
                            } catch(e) {
                                orderDetails = order.package_selected || 'Unknown';
                            }
                            result += '  * ' + order.id + ': ' + orderDetails + ' (from ' + order.source + ')\n';
                        });
                    });
                    
                    $('#seller-orders-result').text(result);
                })
                .fail(function(xhr) {
                    $('#seller-orders-result').text('Error: ' + xhr.status + ' - ' + xhr.responseText);
                });
        });

        // Initial check
        checkLoginStatus();
    </script>
</body>
</html>
